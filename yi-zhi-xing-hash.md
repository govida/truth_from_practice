---
description: 提高并发的又一种手段
---

# 一致性hash

一般来说，通过master-worker模式，借助消息通道挺高并发是最常用的一种方案，但是假如master发的还不够快，怎么办呢？@来自于海栋大佬的质问

## 分片调度

本质上，来说一致性hash是一种分片调度，每个节点管理一片区间的数据

## 一致性

分片大家都懂，关键在于：

* 如何保证某个节点挂掉了，又没有太大影响（必然会影响当前，但不会太久）
* 如何保证当前处理节点不够多，在添加个新节点，大家马上会知道自己该处理哪一段区间数据

简单来说：

1. 提取任务区间，hash形成一个环 00000000-ffffffff
2. 插入节点，A-&gt;B-&gt;C-&gt;A
3. 每个节点负责处理自己节点到下一个节点之间的数据

这样的话：

1. 某个节点挂掉了，只会影响自己处理的部分区间数据，且通过心跳机制，上一个节点会肩负起处理当前挂掉节点的数据
2. 插入一个新节点后，显而易见，大家都知道自己该处理哪了

### 虚拟位点

上述，方案存在几个问题：

* 大家可能散列的比较密集，这样大家负载不一样，机器利用率也不一样
* 引入新节点，只减轻了当前插入节点前一个节点的负载，对其他机器无益

由此，引入虚拟位点，很简单，每个节点多差几个位置就好了

a1-&gt;b1-&gt;c1-&gt;b2-&gt;c2-&gt;a2-&gt;c3-&gt;b3-&gt;a3--&gt;a1

参考文献：

* [白话解析：一致性哈希算法 consistent hashing](http://www.zsythink.net/archives/1182)

